<!-- file:///Users/ayushgupta/Desktop/jitsi.html?roomName=dkdkdkdk&from=external -->
<!-- https://guptayush02.github.io/jitsi_meet/?roomName=4aec1ce86d&from=external -->

<html itemscope itemtype="http://schema.org/Product" prefix="og: http://ogp.me/ns#" xmlns="http://www.w3.org/1999/html">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="content-type" content="text/html;charset=utf-8">
    </head>
    <body>
        <script src="https://meet.jit.si/external_api.js"></script>
        <script>
            const urlSearchParams = new URLSearchParams(window.location.search);
            const params = Object.fromEntries(urlSearchParams.entries());
            const { roomName, from } = params
            let displayVideo = from === "external" ? false : true

            const domain = `meet.jit.si`;
            const options = {
                roomName,
                width: 800,
                height: 1700,
                parentNode: undefined,
                configOverwrite: {
                    "prejoinPageEnabled": false,
                    "startWithAudioMuted": false,
                    "startWithVideoMuted": displayVideo
                },
                "userInfo": {
                    "displayName": from === "external" ? "Someone from outside" : "Inside",
                },
                interfaceConfigOverwrite: {}
            }
            const api = new JitsiMeetExternalAPI(domain, options);

            // add ajax to hit rails backend server to triger video call on frontend
            // const xhr = new XMLHttpRequest();
            // const url = `https://doorbellonline.in/calling?room_name=${roomName}`;
            // xhr.open("GET", url, true);
            // xhr.onreadystatechange = function () {
            //     if (this.readyState == 4 && this.status == 200) {
            //         console.log("======>", this.responseText);
            //     }
            // }
            // // Sending our request
            // xhr.send();

            const url = `https://doorbellonline.in/calling?room_name=${roomName}`;
            const xhttp = new XMLHttpRequest();
            xhttp.onload = function() {
                console.log("this.responseText---->", this.responseText)
            }
            xhttp.open("GET", url);
            xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhttp.setRequestHeader("Access-Control-Allow-Headers", "*");
            xhttp.send(`room_name=${roomName}`);
        </script>
    </body>
</html>
