<!-- file:///Users/ayushgupta/Desktop/jitsi.html?roomName=dkdkdkdk&from=external -->

<html itemscope itemtype="http://schema.org/Product" prefix="og: http://ogp.me/ns#" xmlns="http://www.w3.org/1999/html">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="content-type" content="text/html;charset=utf-8">
    </head>
    <body>
        <script src="https://meet.jit.si/external_api.js"></script>
        <script>
            const urlSearchParams = new URLSearchParams(window.location.search);
            const params = Object.fromEntries(urlSearchParams.entries());
            const { roomName, from } = params
            let displayVideo = from === "external" ? false : true

            const domain = `meet.jit.si`;
            const options = {
                roomName,
                width: 800,
                height: 1700,
                parentNode: undefined,
                configOverwrite: {
                    "prejoinPageEnabled": false,
                    "startWithAudioMuted": false,
                    "startWithVideoMuted": displayVideo
                },
                "userInfo": {
                    "displayName": from === "external" ? "Someone from outside" : "Inside",
                },
                interfaceConfigOverwrite: {}
            }
            const api = new JitsiMeetExternalAPI(domain, options);

            
            // window.addEventListener("DOMContentLoaded", function() {
            //     document.querySelectorAll('.css-1l3cxcu-linkLabel')[1].click()
            // });

            // add ajax to hit rails backend server to triger video call on frontend
            const xhr = new XMLHttpRequest();
            const url = `https://44.203.248.151:3000/calling?room_name=${roomName}`
            xhr.open("GET", url, true);
            xhr.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    console.log("======>", this.responseText);
                }
            }
            // Sending our request 
            xhr.send();
        </script>
    </body>
</html>
